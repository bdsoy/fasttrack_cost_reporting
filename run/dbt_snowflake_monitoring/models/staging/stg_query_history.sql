-- back compat for old kwarg name
  
  begin;
    
        
            
                
                
            
                
                
            
        
    

    

    merge into fasttrack_cost_reporting_dev.landing_snowflake_monitoring.stg_query_history as DBT_INTERNAL_DEST
        using fasttrack_cost_reporting_dev.landing_snowflake_monitoring.stg_query_history__dbt_tmp as DBT_INTERNAL_SOURCE
        on (
                    DBT_INTERNAL_SOURCE.query_id = DBT_INTERNAL_DEST.query_id
                ) and (
                    DBT_INTERNAL_SOURCE.start_time = DBT_INTERNAL_DEST.start_time
                )

    
    when matched then update set
        "QUERY_ID" = DBT_INTERNAL_SOURCE."QUERY_ID","QUERY_TEXT" = DBT_INTERNAL_SOURCE."QUERY_TEXT","DATABASE_ID" = DBT_INTERNAL_SOURCE."DATABASE_ID","DATABASE_NAME" = DBT_INTERNAL_SOURCE."DATABASE_NAME","SCHEMA_ID" = DBT_INTERNAL_SOURCE."SCHEMA_ID","SCHEMA_NAME" = DBT_INTERNAL_SOURCE."SCHEMA_NAME","QUERY_TYPE" = DBT_INTERNAL_SOURCE."QUERY_TYPE","SESSION_ID" = DBT_INTERNAL_SOURCE."SESSION_ID","USER_NAME" = DBT_INTERNAL_SOURCE."USER_NAME","ROLE_NAME" = DBT_INTERNAL_SOURCE."ROLE_NAME","WAREHOUSE_ID" = DBT_INTERNAL_SOURCE."WAREHOUSE_ID","WAREHOUSE_NAME" = DBT_INTERNAL_SOURCE."WAREHOUSE_NAME","WAREHOUSE_SIZE" = DBT_INTERNAL_SOURCE."WAREHOUSE_SIZE","WAREHOUSE_TYPE" = DBT_INTERNAL_SOURCE."WAREHOUSE_TYPE","CLUSTER_NUMBER" = DBT_INTERNAL_SOURCE."CLUSTER_NUMBER","QUERY_TAG" = DBT_INTERNAL_SOURCE."QUERY_TAG","EXECUTION_STATUS" = DBT_INTERNAL_SOURCE."EXECUTION_STATUS","ERROR_CODE" = DBT_INTERNAL_SOURCE."ERROR_CODE","ERROR_MESSAGE" = DBT_INTERNAL_SOURCE."ERROR_MESSAGE","START_TIME" = DBT_INTERNAL_SOURCE."START_TIME","END_TIME" = DBT_INTERNAL_SOURCE."END_TIME","TOTAL_ELAPSED_TIME" = DBT_INTERNAL_SOURCE."TOTAL_ELAPSED_TIME","BYTES_SCANNED" = DBT_INTERNAL_SOURCE."BYTES_SCANNED","PERCENTAGE_SCANNED_FROM_CACHE" = DBT_INTERNAL_SOURCE."PERCENTAGE_SCANNED_FROM_CACHE","BYTES_WRITTEN" = DBT_INTERNAL_SOURCE."BYTES_WRITTEN","BYTES_WRITTEN_TO_RESULT" = DBT_INTERNAL_SOURCE."BYTES_WRITTEN_TO_RESULT","BYTES_READ_FROM_RESULT" = DBT_INTERNAL_SOURCE."BYTES_READ_FROM_RESULT","ROWS_PRODUCED" = DBT_INTERNAL_SOURCE."ROWS_PRODUCED","ROWS_INSERTED" = DBT_INTERNAL_SOURCE."ROWS_INSERTED","ROWS_UPDATED" = DBT_INTERNAL_SOURCE."ROWS_UPDATED","ROWS_DELETED" = DBT_INTERNAL_SOURCE."ROWS_DELETED","ROWS_UNLOADED" = DBT_INTERNAL_SOURCE."ROWS_UNLOADED","BYTES_DELETED" = DBT_INTERNAL_SOURCE."BYTES_DELETED","PARTITIONS_SCANNED" = DBT_INTERNAL_SOURCE."PARTITIONS_SCANNED","PARTITIONS_TOTAL" = DBT_INTERNAL_SOURCE."PARTITIONS_TOTAL","BYTES_SPILLED_TO_LOCAL_STORAGE" = DBT_INTERNAL_SOURCE."BYTES_SPILLED_TO_LOCAL_STORAGE","BYTES_SPILLED_TO_REMOTE_STORAGE" = DBT_INTERNAL_SOURCE."BYTES_SPILLED_TO_REMOTE_STORAGE","BYTES_SENT_OVER_THE_NETWORK" = DBT_INTERNAL_SOURCE."BYTES_SENT_OVER_THE_NETWORK","COMPILATION_TIME" = DBT_INTERNAL_SOURCE."COMPILATION_TIME","EXECUTION_TIME" = DBT_INTERNAL_SOURCE."EXECUTION_TIME","QUEUED_PROVISIONING_TIME" = DBT_INTERNAL_SOURCE."QUEUED_PROVISIONING_TIME","QUEUED_REPAIR_TIME" = DBT_INTERNAL_SOURCE."QUEUED_REPAIR_TIME","QUEUED_OVERLOAD_TIME" = DBT_INTERNAL_SOURCE."QUEUED_OVERLOAD_TIME","TRANSACTION_BLOCKED_TIME" = DBT_INTERNAL_SOURCE."TRANSACTION_BLOCKED_TIME","OUTBOUND_DATA_TRANSFER_CLOUD" = DBT_INTERNAL_SOURCE."OUTBOUND_DATA_TRANSFER_CLOUD","OUTBOUND_DATA_TRANSFER_REGION" = DBT_INTERNAL_SOURCE."OUTBOUND_DATA_TRANSFER_REGION","OUTBOUND_DATA_TRANSFER_BYTES" = DBT_INTERNAL_SOURCE."OUTBOUND_DATA_TRANSFER_BYTES","INBOUND_DATA_TRANSFER_CLOUD" = DBT_INTERNAL_SOURCE."INBOUND_DATA_TRANSFER_CLOUD","INBOUND_DATA_TRANSFER_REGION" = DBT_INTERNAL_SOURCE."INBOUND_DATA_TRANSFER_REGION","INBOUND_DATA_TRANSFER_BYTES" = DBT_INTERNAL_SOURCE."INBOUND_DATA_TRANSFER_BYTES","LIST_EXTERNAL_FILES_TIME" = DBT_INTERNAL_SOURCE."LIST_EXTERNAL_FILES_TIME","CREDITS_USED_CLOUD_SERVICES" = DBT_INTERNAL_SOURCE."CREDITS_USED_CLOUD_SERVICES","RELEASE_VERSION" = DBT_INTERNAL_SOURCE."RELEASE_VERSION","EXTERNAL_FUNCTION_TOTAL_INVOCATIONS" = DBT_INTERNAL_SOURCE."EXTERNAL_FUNCTION_TOTAL_INVOCATIONS","EXTERNAL_FUNCTION_TOTAL_SENT_ROWS" = DBT_INTERNAL_SOURCE."EXTERNAL_FUNCTION_TOTAL_SENT_ROWS","EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS" = DBT_INTERNAL_SOURCE."EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS","EXTERNAL_FUNCTION_TOTAL_SENT_BYTES" = DBT_INTERNAL_SOURCE."EXTERNAL_FUNCTION_TOTAL_SENT_BYTES","EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES" = DBT_INTERNAL_SOURCE."EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES","QUERY_LOAD_PERCENT" = DBT_INTERNAL_SOURCE."QUERY_LOAD_PERCENT","IS_CLIENT_GENERATED_STATEMENT" = DBT_INTERNAL_SOURCE."IS_CLIENT_GENERATED_STATEMENT","QUERY_ACCELERATION_BYTES_SCANNED" = DBT_INTERNAL_SOURCE."QUERY_ACCELERATION_BYTES_SCANNED","QUERY_ACCELERATION_PARTITIONS_SCANNED" = DBT_INTERNAL_SOURCE."QUERY_ACCELERATION_PARTITIONS_SCANNED","QUERY_ACCELERATION_UPPER_LIMIT_SCALE_FACTOR" = DBT_INTERNAL_SOURCE."QUERY_ACCELERATION_UPPER_LIMIT_SCALE_FACTOR","QUERY_HASH" = DBT_INTERNAL_SOURCE."QUERY_HASH","QUERY_HASH_VERSION" = DBT_INTERNAL_SOURCE."QUERY_HASH_VERSION","QUERY_PARAMETERIZED_HASH" = DBT_INTERNAL_SOURCE."QUERY_PARAMETERIZED_HASH","QUERY_PARAMETERIZED_HASH_VERSION" = DBT_INTERNAL_SOURCE."QUERY_PARAMETERIZED_HASH_VERSION","QUERY_RETRY_TIME" = DBT_INTERNAL_SOURCE."QUERY_RETRY_TIME","QUERY_RETRY_CAUSE" = DBT_INTERNAL_SOURCE."QUERY_RETRY_CAUSE","FAULT_HANDLING_TIME" = DBT_INTERNAL_SOURCE."FAULT_HANDLING_TIME"
    

    when not matched then insert
        ("QUERY_ID", "QUERY_TEXT", "DATABASE_ID", "DATABASE_NAME", "SCHEMA_ID", "SCHEMA_NAME", "QUERY_TYPE", "SESSION_ID", "USER_NAME", "ROLE_NAME", "WAREHOUSE_ID", "WAREHOUSE_NAME", "WAREHOUSE_SIZE", "WAREHOUSE_TYPE", "CLUSTER_NUMBER", "QUERY_TAG", "EXECUTION_STATUS", "ERROR_CODE", "ERROR_MESSAGE", "START_TIME", "END_TIME", "TOTAL_ELAPSED_TIME", "BYTES_SCANNED", "PERCENTAGE_SCANNED_FROM_CACHE", "BYTES_WRITTEN", "BYTES_WRITTEN_TO_RESULT", "BYTES_READ_FROM_RESULT", "ROWS_PRODUCED", "ROWS_INSERTED", "ROWS_UPDATED", "ROWS_DELETED", "ROWS_UNLOADED", "BYTES_DELETED", "PARTITIONS_SCANNED", "PARTITIONS_TOTAL", "BYTES_SPILLED_TO_LOCAL_STORAGE", "BYTES_SPILLED_TO_REMOTE_STORAGE", "BYTES_SENT_OVER_THE_NETWORK", "COMPILATION_TIME", "EXECUTION_TIME", "QUEUED_PROVISIONING_TIME", "QUEUED_REPAIR_TIME", "QUEUED_OVERLOAD_TIME", "TRANSACTION_BLOCKED_TIME", "OUTBOUND_DATA_TRANSFER_CLOUD", "OUTBOUND_DATA_TRANSFER_REGION", "OUTBOUND_DATA_TRANSFER_BYTES", "INBOUND_DATA_TRANSFER_CLOUD", "INBOUND_DATA_TRANSFER_REGION", "INBOUND_DATA_TRANSFER_BYTES", "LIST_EXTERNAL_FILES_TIME", "CREDITS_USED_CLOUD_SERVICES", "RELEASE_VERSION", "EXTERNAL_FUNCTION_TOTAL_INVOCATIONS", "EXTERNAL_FUNCTION_TOTAL_SENT_ROWS", "EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS", "EXTERNAL_FUNCTION_TOTAL_SENT_BYTES", "EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES", "QUERY_LOAD_PERCENT", "IS_CLIENT_GENERATED_STATEMENT", "QUERY_ACCELERATION_BYTES_SCANNED", "QUERY_ACCELERATION_PARTITIONS_SCANNED", "QUERY_ACCELERATION_UPPER_LIMIT_SCALE_FACTOR", "QUERY_HASH", "QUERY_HASH_VERSION", "QUERY_PARAMETERIZED_HASH", "QUERY_PARAMETERIZED_HASH_VERSION", "QUERY_RETRY_TIME", "QUERY_RETRY_CAUSE", "FAULT_HANDLING_TIME")
    values
        ("QUERY_ID", "QUERY_TEXT", "DATABASE_ID", "DATABASE_NAME", "SCHEMA_ID", "SCHEMA_NAME", "QUERY_TYPE", "SESSION_ID", "USER_NAME", "ROLE_NAME", "WAREHOUSE_ID", "WAREHOUSE_NAME", "WAREHOUSE_SIZE", "WAREHOUSE_TYPE", "CLUSTER_NUMBER", "QUERY_TAG", "EXECUTION_STATUS", "ERROR_CODE", "ERROR_MESSAGE", "START_TIME", "END_TIME", "TOTAL_ELAPSED_TIME", "BYTES_SCANNED", "PERCENTAGE_SCANNED_FROM_CACHE", "BYTES_WRITTEN", "BYTES_WRITTEN_TO_RESULT", "BYTES_READ_FROM_RESULT", "ROWS_PRODUCED", "ROWS_INSERTED", "ROWS_UPDATED", "ROWS_DELETED", "ROWS_UNLOADED", "BYTES_DELETED", "PARTITIONS_SCANNED", "PARTITIONS_TOTAL", "BYTES_SPILLED_TO_LOCAL_STORAGE", "BYTES_SPILLED_TO_REMOTE_STORAGE", "BYTES_SENT_OVER_THE_NETWORK", "COMPILATION_TIME", "EXECUTION_TIME", "QUEUED_PROVISIONING_TIME", "QUEUED_REPAIR_TIME", "QUEUED_OVERLOAD_TIME", "TRANSACTION_BLOCKED_TIME", "OUTBOUND_DATA_TRANSFER_CLOUD", "OUTBOUND_DATA_TRANSFER_REGION", "OUTBOUND_DATA_TRANSFER_BYTES", "INBOUND_DATA_TRANSFER_CLOUD", "INBOUND_DATA_TRANSFER_REGION", "INBOUND_DATA_TRANSFER_BYTES", "LIST_EXTERNAL_FILES_TIME", "CREDITS_USED_CLOUD_SERVICES", "RELEASE_VERSION", "EXTERNAL_FUNCTION_TOTAL_INVOCATIONS", "EXTERNAL_FUNCTION_TOTAL_SENT_ROWS", "EXTERNAL_FUNCTION_TOTAL_RECEIVED_ROWS", "EXTERNAL_FUNCTION_TOTAL_SENT_BYTES", "EXTERNAL_FUNCTION_TOTAL_RECEIVED_BYTES", "QUERY_LOAD_PERCENT", "IS_CLIENT_GENERATED_STATEMENT", "QUERY_ACCELERATION_BYTES_SCANNED", "QUERY_ACCELERATION_PARTITIONS_SCANNED", "QUERY_ACCELERATION_UPPER_LIMIT_SCALE_FACTOR", "QUERY_HASH", "QUERY_HASH_VERSION", "QUERY_PARAMETERIZED_HASH", "QUERY_PARAMETERIZED_HASH_VERSION", "QUERY_RETRY_TIME", "QUERY_RETRY_CAUSE", "FAULT_HANDLING_TIME")

;
    commit;